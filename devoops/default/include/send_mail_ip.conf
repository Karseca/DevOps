##########################################################################
#
# Function send_mail_ips used on check_ip.sh
#
# This function parses the final data file and send email with the 
# hosts inserted on the wrong instance of the server
#
##########################################################################

function send_mail_ips {
        (
	echo "From: ${source_email[1]}"
        echo "To: ${source_email[@]:0:1}"
        echo "Cc: ${source_email[@]:2:4}"
        echo "MIME-Version: 1.0"
        echo "Content-Type: text/html; charset=UTF-8"
        echo -e "Subject: Monitorizacao - Verificacao de servidores em instancias incorrectas - CX/CV/DMZ's"
        echo -e "<p align="center"><b><pre>Sum&aacute;rio:</b></p></pre>"
        echo -e "<p><pre>Existem $(cat $work_tmp/${source_inst[0]}_cx_dmz.txt | wc -l) m&aacute;quinas da DMZ CX na instancia ${source_inst[0]} de CX PRD, $(cat $work_tmp/${source_inst[0]}_cv_dmz_cx.txt | wc -l) m&aacute;quinas da DMZ CV na instancia ${source_inst[0]} de CX PRD, $(cat $work_tmp/${source_inst[0]}_cv_cx.txt | wc -l) m&aacute;quinas da CV PRD na instancia ${source_inst[0]} de CX PRD,</pre><br>"
        echo -e "<p><pre> $(cat $work_tmp/${source_inst[3]}_cx_dmz.txt | wc -l) m&aacute;quinas da DMZ CX na instancia ${source_inst[3]} de CX PRD, $(cat $work_tmp/${source_inst[0]}_cv_dmz_cx.txt | wc -l) m&aacute;quinas da DMZ CV na instancia ${source_inst[3]} de CX PRD, $(cat $work_tmp/${source_inst[3]}_cv_cx.txt | wc -l) m&aacute;quinas da CV PRD na instancia ${source_inst[3]} de CX PRD,</pre><br>"
        echo -e "<p><pre> $(cat $work_tmp/${source_inst[6]}_cx_dmz.txt | wc -l) m&aacute;quinas da DMZ CX na instancia ${source_inst[6]} de CX PRD, $(cat $work_tmp/${source_inst[0]}_cv_dmz_cx.txt | wc -l) m&aacute;quinas da DMZ CV na instancia ${source_inst[6]} de CX PRD, $(cat $work_tmp/${source_inst[6]}_cv_cx.txt | wc -l) m&aacute;quinas da CV PRD na instancia ${source_inst[6]} de CX PRD,</pre><br>"
        echo -e "<p><pre> $(cat $work_tmp/${source_inst[9]}_cx_dmz.txt | wc -l) m&aacute;quinas da DMZ CX na instancia ${source_inst[9]} de CX PRD, $(cat $work_tmp/${source_inst[0]}_cv_dmz_cx.txt | wc -l) m&aacute;quinas da DMZ CV na instancia ${source_inst[9]} de CX PRD, $(cat $work_tmp/${source_inst[9]}_cv_cx.txt | wc -l) m&aacute;quinas da CV PRD na instancia ${source_inst[9]} de CX PRD,</pre><br>"
        echo -e "<p><pre> $(cat $work_tmp/${source_inst[12]}_cx_dmz.txt | wc -l) m&aacute;quinas da DMZ CX na instancia ${source_inst[12]} de CX PRD, $(cat $work_tmp/${source_inst[0]}_cv_dmz_cx.txt | wc -l) m&aacute;quinas da DMZ CV na instancia ${source_inst[12]} de CX PRD, $(cat $work_tmp/${source_inst[12]}_cv_cx.txt | wc -l) m&aacute;quinas da CV PRD na instancia ${source_inst[12]} de CX PRD</pre><br>"
        echo -e "<p><pre> $(cat $work_tmp/${source_inst[15]}_cx_cv.txt | wc -l) m&aacute;quinas de CX na instancia ${source_inst[15]} de CV PRD, $(cat $work_tmp/${source_inst[15]}_cv_dmz_cv.txt | wc -l) m&aacute;quinas da DMZ CV na instancia ${source_inst[15]} de CV PRD, $(cat $work_tmp/${source_inst[15]}_cx_dmz_cv.txt | wc -l) m&aacute;quinas da DMZ CX na instancia ${source_inst[15]} de CV PRD</pre><br>"
        echo -e "<p><pre> $(cat $work_tmp/${source_inst[18]}_cx_cv.txt | wc -l) m&aacute;quinas de CX na instancia ${source_inst[18]} de CV PRD, $(cat $work_tmp/${source_inst[18]}_cv_dmz_cv.txt | wc -l) m&aacute;quinas da DMZ CV na instancia ${source_inst[18]} de CV PRD, $(cat $work_tmp/${source_inst[18]}_cx_dmz_cv.txt | wc -l) m&aacute;quinas da DMZ CX na instancia ${source_inst[18]} de CV PRD</pre><br>"
        echo -e "<html><body><p><table border=1><caption><font size="6"><b>Check_MK | M&aacute;quinas em instancias incorrectas</b></font></caption><tr>"
        echo -e "<th><p>Instancia</th><th><p>Servidores</th><th><p>IP</th></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[0]}_cx_dmz.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[0]}_cx_dmz.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[0]}_cx_dmz.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[0]}_cv_dmz_cx.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[0]}_cv_dmz_cx.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[0]}_cv_dmz_cx.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[0]}_cv_cx.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[0]}_cv_cx.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[0]}_cv_cx.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[3]}_cx_dmz.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[3]}_cx_dmz.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[3]}_cx_dmz.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[3]}_cv_dmz_cx.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[3]}_cv_dmz_cx.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[3]}_cv_dmz_cx.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[3]}_cv_cx.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[3]}_cv_cx.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[3]}_cv_cx.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[6]}_cx_dmz.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[6]}_cx_dmz.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[6]}_cx_dmz.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[6]}_cv_dmz_cx.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[6]}_cv_dmz_cx.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[6]}_cv_dmz_cx.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[6]}_cv_cx.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[6]}_cv_cx.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[6]}_cv_cx.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[9]}_cx_dmz.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[9]}_cx_dmz.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[9]}_cx_dmz.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[9]}_cv_dmz_cx.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[9]}_cv_dmz_cx.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[9]}_cv_dmz_cx.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[9]}_cv_cx.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[9]}_cv_cx.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[9]}_cv_cx.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[12]}_cx_dmz.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[12]}_cx_dmz.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[12]}_cx_dmz.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[12]}_cv_dmz_cx.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[12]}_cv_dmz_cx.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[12]}_cv_dmz_cx.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[12]}_cv_cx.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[12]}_cv_cx.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[12]}_cv_cx.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[15]}_cx_cv.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[15]}_cx_cv.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[15]}_cx_cv.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[15]}_cv_dmz_cv.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[15]}_cv_dmz_cv.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[15]}_cv_dmz_cv.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[15]}_cx_dmz_cv.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[15]}_cx_dmz_cv.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[15]}_cx_dmz_cv.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[18]}_cx_cv.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[18]}_cx_cv.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[18]}_cx_cv.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[18]}_cv_dmz_cv.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[18]}_cv_dmz_cv.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[18]}_cv_dmz_cv.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "<tr><td valign="top"><pre>$(cat $work_tmp/${source_inst[18]}_cx_dmz_cv.txt | awk '{ print $1 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[18]}_cx_dmz_cv.txt | awk '{ print $2 }')</pre></td><td valign="top"><pre>$(cat $work_tmp/${source_inst[18]}_cx_dmz_cv.txt | awk '{ print $3 }')</pre></td></tr>"
        echo -e "</table><pre><hr><pre>$HOSTNAME $PWD $0 $SECONDS</pre></hr></pre></body></html>"
        ) | sendmail -t
}
